// Adventure - v0.0.0 - 11/11/2011
// 
// Copyright (c) 2011 Rick Waldron, Mike Pennisi; Licensed MIT
(function(a,$,b,c){var d={pop:null,tracks:null,outcomes:null,init:function(a){var e=d,f={media:$.Deferred(),events:$.Deferred()};e.pop=c(a.mediaId),e.outcomes=a.outcomes,e.pop.listen("canplayall",function(){f.media.resolve(e.pop)}),$.getJSON(a.events,function(a){f.events.resolve(a)}),$.when(f.media,f.events).then(function(c,d){console.log("Continue to movie setup",c,d);var f={cues:a.cues||{},tracks:d||[],handlers:a.handlers},g=[];b.forEach(e.setup,function(a,d){var h=f[d],i=$.Deferred();a.call(c,h,i,e),g.push(i),b.size(h)===0&&i.resolve()}),$.when.apply(null,g).then(function(){console.log("Ready for assertion tests"),e.pop.play()})})},setup:{tracks:function(a,c,d){var e=b.size(a);b.forEach(a,function(a,d){var f=b.keys(a)[0],g=b.values(a)[0];this[f](g),d+1===e&&c.resolve()},this)},cues:function(a,c,d){var e=b.size(a),f=0;b.forEach(a,function(a,b){this.cue(+b,a),f+1===e&&c.resolve(),f++},this)},handlers:function(a,c,d){var e=b.size(a),f=0;b.forEach(a,function(a,g){var h=$(g);b.forEach(a,function(a,b){var c=b.split(" on ");c.push(d,a),h.on.apply(h,c)}),f+1===e&&c.resolve(),f++},this)}}};a.Adventure=d.init})(this,this.jQuery,this._,this.Popcorn),$(function(){Adventure({mediaId:"#adventure",events:"adventure.json",cues:{0:function(){$(this.media).animate({opacity:1},"med")},6:function(){this.pause()},12:function(){this.play(.25)},22:function(){$(this.media).animate({opacity:0},"med")}},outcomes:{a:function(){this.play(13)},b:function(){this.play()}},handlers:{"#adventure-world":{"click on [data-choice]":function(a){a.preventDefault();var b=$(this);a.data.outcomes[b.data("choice")].call(a.data.pop)}}}})})